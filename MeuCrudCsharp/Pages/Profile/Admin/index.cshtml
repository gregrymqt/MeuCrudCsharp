@page
@model MeuCrudCsharp.Pages.Profile.Admin.indexModel
@{
    ViewData["Title"] = "Gerenciar Planos de Assinatura";
}

<!-- 1. Dependência para os Ícones (Font Awesome) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link rel="stylesheet" href="~/css/admin/Profile/index.css" asp-append-version="true"/>
<!-- 3. Estrutura HTML com a Sidebar -->
<div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">Gerenciamento</div>
        <ul class="sidebar-nav">
            <li><a href="#" id="nav-plans" class="sidebar-link active"><i class="fas fa-tags"></i> Gerenciar Planos</a>
            </li>
            <li><a href="#" id="nav-courses" class="sidebar-link active"><i class="fas fa-tags"></i> Gerenciar
                    Cursos</a>
            </li>
            <li><a href="#" id="nav-students" class="sidebar-link"><i class="fas fa-users"></i> Alunos</a></li>
            <li><a href="#" id="nav-subscriptions" class="sidebar-link"><i class="fas fa-cogs"></i> Gerenciar
                    Assinaturas</a></li>
        </ul>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="admin-main-content">
        <div class="admin-container">

            <div id="content-courses" class="content-panel">
                <!-- Seção 1: Criar Novo Curso -->
                <div class="form-section">
                    <h2>Criar Novo Curso</h2>
                    <form id="create-course-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="course-name-new">Nome do Curso</label>
                                <input type="text" id="course-name-new" class="form-control" required
                                       placeholder="Ex: Dominando C#">
                            </div>
                            <div class="form-group">
                                <label for="course-description-new">Descrição do Curso</label>
                                <textarea id="course-description-new" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Curso</button>
                    </form>
                </div>

                <hr class="section-divider">

                <!-- Seção 2: Cursos Existentes (READ, UPDATE, DELETE) -->
                <div class="list-section">
                    <h2>Cursos Existentes</h2>
                    <div class="form-group">
                        <input type="text" id="search-course-input" class="form-control"
                               placeholder="Buscar curso por nome ou ID...">
                    </div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Nome do Curso</th>
                            <th>Descrição</th>
                            <th>Ações</th>
                        </tr>
                        </thead>
                        <tbody id="courses-table-body">
                        <!-- O JavaScript irá popular esta tabela -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Painel "Criar Plano" -->

            <div id="content-plans" class="content-panel active">

                <!-- Seção 1: Criar Novo Plano (Seu formulário existente) -->
                <div class="form-section">
                    <h2>Criar Novo Plano de Assinatura</h2>
                    <form id="create-plan-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="plan-reason">Nome do Plano (Motivo)</label>
                                <input type="text" id="plan-reason" class="form-control"
                                       placeholder="Ex: Acesso Mensal Premium" required>
                            </div>
                            <div class="form-group">
                                <label for="plan-type">Tipo de Plano</label>
                                <select id="plan-type" class="form-select">
                                    <option value="months" selected>Mensal</option>
                                    <option value="years">Anual</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="plan-amount">Valor (R$)</label>
                                <input type="number" id="plan-amount" class="form-control" step="0.01"
                                       placeholder="Ex: 49.90" required>
                            </div>
                            <div class="form-group">
                                <label for="plan-amount">Descrição do Curso</label>
                                <input type="text" id="plan-description" class="form-control" 
                                       placeholder="Ex: Torne-se um programador" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Criar Plano no Mercado Pago</button>
                    </form>
                </div>

                <!-- Divisor visual entre as seções -->
                <hr class="section-divider">

                <!-- NOVO: Seção 2: Gerenciar Planos Existentes (Read, Update, Delete) -->
                <div class="list-section">
                    <h2>Planos Existentes</h2>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Nome do Plano</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                        </thead>
                        <tbody id="plans-table-body">
                        <!-- O JavaScript irá popular esta tabela com os dados da API -->
                        <tr>
                            <td colspan="5" class="text-center">Carregando planos...</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Painel "Alunos" -->
            <div id="content-students" class="content-panel">
                <h2>Lista de Alunos</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Status Assinatura</th>
                        <th>Data de Cadastro</th>
                    </tr>
                    </thead>
                    <tbody id="students-table-body">
                    <tr>
                        <td colspan="4" style="text-align: center;">Carregando alunos...</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Painel "Gerenciar Assinaturas" -->
            <div id="content-subscriptions" class="content-panel">
                <h2>Gerenciar Assinaturas</h2>
                <div class="form-group">
                    <label for="subscription-action-selector">Selecione uma Ação</label>
                    <select id="subscription-action-selector" class="form-select">
                        <option value="">-- Escolha uma operação --</option>
                        <option value="search">Buscar Assinatura</option>
                        <option value="update-value">Alterar Valor</option>
                        <option value="pause-cancel">Pausar ou Cancelar</option>
                        <option value="reactivate">Reativar Assinatura</option>
                    </select>
                </div>

                <div id="subscription-actions-container">
                    <form id="form-search" class="action-form">
                        <div class="form-group">
                            <label for="search-id">Buscar por ID da Assinatura ou Email do Aluno</label>
                            <div class="input-group">
                                <input type="text" id="search-id" class="form-control" placeholder="ID ou email..."
                                       required>
                                <button type="submit" class="btn btn-primary">Buscar</button>
                            </div>
                        </div>
                    </form>
                    <form id="form-update-value" class="action-form">
                        <div class="form-group"><label for="update-value-id">ID da Assinatura</label><input type="text"
                                                                                                            id="update-value-id"
                                                                                                            class="form-control"
                                                                                                            required>
                        </div>
                        <div class="form-group"><label for="update-value-amount">Novo Valor (R$)</label><input
                                type="number" id="update-value-amount" class="form-control" step="0.01" required></div>
                        <button type="submit" class="btn btn-warning">Alterar Valor</button>
                    </form>
                    <form id="form-pause-cancel" class="action-form">
                        <div class="form-group"><label for="pause-cancel-id">ID da Assinatura</label><input type="text"
                                                                                                            id="pause-cancel-id"
                                                                                                            class="form-control"
                                                                                                            required>
                        </div>
                        <button type="submit" name="status" value="paused" class="btn btn-secondary">Pausar</button>
                        <button type="submit" name="status" value="cancelled" class="btn btn-danger">Cancelar</button>
                    </form>
                    <form id="form-reactivate" class="action-form">
                        <div class="form-group"><label for="reactivate-id">ID da Assinatura (deve estar
                                pausada)</label><input type="text" id="reactivate-id" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-success">Reativar Assinatura</button>
                    </form>
                </div>

                <div id="action-results" style="margin-top: 1.5rem;"></div>
            </div>
        </div>
    </main>
</div>

<div id="edit-course-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Editar Curso</h3>
            <span class="close-button" id="close-edit-course-modal">&times;</span>
        </div>
        <form id="edit-course-form">
            <input type="hidden" id="edit-course-id">
            <div class="form-group">
                <label for="edit-course-name">Nome do Curso</label>
                <input type="text" id="edit-course-name" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="edit-course-description">Descrição</label>
                <textarea id="edit-course-description" class="form-control" rows="4"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
        </form>
    </div>
</div>

<div id="edit-plan-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Editar Plano</h3>
            <span class="close-button" id="close-edit-plan-modal">&times;</span>
        </div>
        <form id="edit-plan-form">
            <input type="hidden" id="edit-plan-id">
            <div class="form-grid">
                <div class="form-group">
                    <label for="edit-plan-reason">Nome do Plano (Motivo)</label>
                    <input type="text" id="edit-plan-reason" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="edit-plan-amount">Valor da Transação (R$)</label>
                    <input type="number" id="edit-plan-amount" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="edit-plan-frequency-type">Tipo de Frequência</label>
                    <select id="edit-plan-frequency-type" class="form-select" disabled>
                        <option value="months">Mensal</option>
                        <option value="years">Anual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-plan-back-url">URL de Retorno</label>
                    <input type="url" id="edit-plan-back-url" class="form-control"
                           placeholder="https://seusite.com/retorno">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
        </form>
    </div>
</div>

<!-- 4. JavaScript para interagir com a API -->
<script src="~/js/admin/Profile/admin-main.js" type="module" defer asp-append-version="true"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
