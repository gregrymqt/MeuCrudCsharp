@page
@model CreditCardModel
@{
    ViewData["Title"] = "Pagamento com Cartão de Crédito";
}

<link rel="stylesheet" href="~/css/credit_card.css" asp-append-version="true" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<div id="credit-card-module" class="payment-module">

    <header class="payment-header">
        <i class="fas fa-credit-card header-icon"></i>
        <h1>Pagamento Seguro</h1>
    </header>

    <div class="order-summary">
        <p>Você está assinando o <strong>Plano @Model.Plano</strong></p>
        <div class="order-total">
            <span>Total</span>
            <strong>R$ @Model.Valor.ToString("F2")</strong>
        </div>
    </div>

    <div class="brick-container">
        <div id="paymentBrick_container"></div>

        <div id="statusScreenBrick_container" style="display: none;"></div>
        
        <div id="loading-container" class="loading-indicator">
            <div class="spinner"></div>
            <p>Carregando formulário de pagamento...</p>
        </div>
    </div>

    <div id="error-container" class="error-message" style="display: none;"></div>

</div>

<script src="https://sdk.mercadopago.com/js/v2"></script>

<script>
    // Passando dados do servidor para o cliente de forma segura e organizada
    window.paymentConfig = {
        preferenceId: '@Model.PreferenceId',
        amount: @Model.Valor.ToString(System.Globalization.CultureInfo.InvariantCulture),
        // A URL para o seu backend que processará o pagamento
        processPaymentUrl: '@Url.Page("/api/credit/card/process-payment", "ProcessPayment")',
        userId: '@Model.user.Id',
    };
</script>

<script src="~/js/payment/Credit-Card/creditCard-main.js" type="module" asp-append-version="true"></script>