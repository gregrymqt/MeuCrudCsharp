@page
@model MeuCrudCsharp.Pages.Payment.CreditCardModel
@{
    ViewData["Title"] = "Pagamento com Cartão de Crédito";
}

<link rel="stylesheet" href="~/css/credit_card.css" asp-append-version="true" />

<main class="py-4">
    <div class="container">
        <div class="payment-container">
            <h2 class="text-center mb-4">Pagamento Seguro</h2>
            <p class="text-center">Você está assinando o <strong>Plano @Model.Plano</strong> no valor de <strong>R$ @Model.Valor.ToString("F2")</strong>.</p>

            <div class="card_page_payment">
                <div id="paymentBrick_container"></div>
                <div id="statusScreenBrick_container" style="display: none;"></div>
                <div id="error-container" style="display: none; color: red; text-align: center; margin-top: 15px;"></div>
                <div id="loading-message" style="text-align: center;">
                    <p>Carregando formulário de pagamento...</p>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://sdk.mercadopago.com/js/v2"></script>

<script>
    // --- O OBJETO DE CONFIGURAÇÃO AGORA É DINÂMICO ---
    window.paymentConfig = {
        publicKey: '@Model.PublicKey',
        preferenceId: '@Model.PreferenceId',
        amount: @Model.Valor.ToString(System.Globalization.CultureInfo.InvariantCulture),
        processPaymentUrl: '@Url.Page("/api/credit/card/process-payment", "ProcessPayment")',
        userId: '@Model.user.Id',
    };
</script>

<script src="~/js/payment-main.js" type="module" asp-append-version="true" defer></script>

