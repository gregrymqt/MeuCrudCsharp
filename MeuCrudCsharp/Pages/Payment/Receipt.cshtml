@page
@* CORREÇÃO 1: Verifique se o namespace e o nome da classe estão corretos. *@
@* Se sua classe .cshtml.cs estiver em um namespace diferente, ajuste aqui. *@
@model ReceiptModel
@{
    ViewData["Title"] = "Comprovante de Pagamento";
}

<!-- Inclui a biblioteca para gerar o PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
    /* Estilos básicos para o comprovante */
    .receipt-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        border: 1px solid #ddd;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .receipt-header {
        text-align: center;
        margin-bottom: 2rem;
        border-bottom: 2px solid #333;
        padding-bottom: 1rem;
    }
    .receipt-details {
        line-height: 1.8;
    }
    .receipt-details strong {
        display: inline-block;
        width: 150px;
    }
    .actions {
        text-align: center;
        margin-top: 2rem;
    }

 @@media print {
        .actions {
            display: none;
        }
    }
</style>

<!-- O conteúdo do comprovante que será impresso/baixado -->
<div id="receipt-content" class="receipt-container">
    <div class="receipt-header">
        <h2>Comprovante de Pagamento</h2>
        <h3>@Model.Receipt.CompanyName</h3>
        <p>CNPJ: @Model.Receipt.CompanyCnpj</p>
    </div>

    <h4>Detalhes da Transação</h4>
    <div class="receipt-details">
        <p><strong>ID do Pagamento:</strong> @Model.Receipt.PaymentId</p>
        <p><strong>Data e Hora:</strong> @Model.Receipt.PaymentDate.ToString("g")</p>
        <p><strong>Status:</strong> <span style="color: green; font-weight: bold;">Aprovado</span></p>
    </div>

    <hr />

    <h4>Dados do Pagador</h4>
    <div class="receipt-details">
        <p><strong>Nome:</strong> @Model.Receipt.CustomerName</p>
        <p><strong>CPF:</strong> @Model.Receipt.CustomerCpf</p>
    </div>
    
    <hr />

    <h4>Resumo do Pagamento</h4>
    <div class="receipt-details">
        <p><strong>Valor Total:</strong> @Model.Receipt.Amount.ToString("C")</p>
        <p><strong>Método:</strong> @Model.Receipt.PaymentMethod</p>
    </div>
</div>

<!-- Botões de Ação -->
<div class="actions">
    <button id="download-btn" class="btn btn-primary">Baixar Comprovante (PDF)</button>
    <button onclick="window.print()" class="btn btn-secondary">Imprimir</button>
</div>

<script>
    document.getElementById('download-btn').addEventListener('click', function () {
        const element = document.getElementById('receipt-content');
        
        // O Razor irá substituir @Model.Receipt.PaymentId pelo valor real antes de enviar ao navegador.
        const fileName = 'comprovante_pagamento_@Model.Receipt.PaymentId';

        const opt = {
            margin:       1,
            filename:     fileName,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        // Gera e baixa o PDF a partir do elemento HTML
        html2pdf().from(element).set(opt).save();
    });
</script>
